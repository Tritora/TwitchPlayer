<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Twitch Redirect</title>
</head>
<body>
  <script>
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');

    if (code) {
      const clientId = '6oibtqptiouosp60jt4cub73tq3b5c';
      const clientSecret = 'g38bh2zo1obbocaif50crzx5z9qup6'; // Sicherer wÃ¤re es, dies serverseitig zu tun
      const redirectUri = 'https://tritora.github.io/TwitchPlayer/';
      const tokenUrl = `https://id.twitch.tv/oauth2/token?client_id=${clientId}&client_secret=${clientSecret}&code=${code}&grant_type=authorization_code&redirect_uri=${redirectUri}`;

      fetch(tokenUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        }
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Fehler beim Abrufen des Access Tokens');
        }
        return response.json();
      })
      .then(data => {
        const accessToken = data.access_token;
        console.log('Access Token:', accessToken);

        return fetch('https://api.twitch.tv/helix/users', {
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Client-Id': clientId
          }
        });
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Fehler beim Abrufen der Benutzerinformationen');
        }
        return response.json();
      })
      .then(userInfo => {
        console.log('User Info:', userInfo);
        const user = userInfo.data[0];
        alert(`Willkommen, ${user.display_name}!`);
        window.location.href = 'next.html';
      })
      .catch(error => {
        console.error('Fehler:', error);
      });
    } else {
      console.error('Authorization Code nicht gefunden');
    }
  </script>
</body>
</html>
